
> chamasmart-backend@1.0.0 test
> jest --runInBand tests/auth.test.js --no-coverage

  console.log
    [dotenv@17.2.3] injecting env (3) from .env -- tip: ≡ƒöÉ prevent committing .env to code: https://dotenvx.com/precommit

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [MOCK] Loading mocked database

      at Object.log (config/__mocks__/db.js:2:9)

  console.log
    STABILIZED: Server running on port 5005

      at Server.log (server.js:235:11)

POST /api/auth/register 201 209.098 ms - anonymous - {"email":"test1768827631256@example.com","password":"[REDACTED]","firstName":"Test","lastName":"User","phoneNumber":"0712345678"}
POST /api/auth/register 400 14.610 ms - anonymous - {"email":"test@example.com"}
POST /api/auth/register 400 1.529 ms - anonymous - {"email":"duplicate1768827631609@example.com","password":"[REDACTED]","firstName":"Test","lastName":"User","phoneNumber":"0712345678"}
  console.log
    Querying database for user: logintest1768827631625@example.com

      at log (controllers/authController.js:263:13)

  console.log
    Database query result: { rowCount: 1 }

      at log (controllers/authController.js:267:13)

POST /api/auth/login 200 53.741 ms - anonymous - {"email":"logintest1768827631625@example.com","password":"[REDACTED]"}
  console.log
    Querying database for user: logintest1768827631625@example.com

      at log (controllers/authController.js:263:13)

  console.log
    Database query result: { rowCount: 1 }

      at log (controllers/authController.js:267:13)

POST /api/auth/login 401 8.841 ms - anonymous - {"email":"logintest1768827631625@example.com","password":"[REDACTED]"}
  console.log
    Querying database for user: nonexistent@example.com

      at log (controllers/authController.js:263:13)

  console.log
    Database query result: { rowCount: 0 }

      at log (controllers/authController.js:267:13)

POST /api/auth/login 401 13.660 ms - anonymous - {"email":"nonexistent@example.com","password":"[REDACTED]"}
FAIL tests/auth.test.js
  Authentication API
    POST /api/auth/register
      ├ù should register a new user (327 ms)
      ΓêÜ should reject registration with missing fields (33 ms)
      ΓêÜ should reject duplicate email (16 ms)
    POST /api/auth/login
      ├ù should login with correct credentials (66 ms)
      ΓêÜ should reject login with wrong password (24 ms)
      ΓêÜ should reject login with non-existent email (31 ms)
  Health Check API
    ΓêÜ should return health status (40 ms)

  ΓùÅ Authentication API ΓÇ║ POST /api/auth/register ΓÇ║ should register a new user

    expect(received).toHaveProperty(path)

    Expected path: "token"
    Received path: []

    Received value: {"data": {"token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MTAwMSwiaWF0IjoxNzY4ODI3NjMxLCJleHAiOjE3Njk0MzI0MzF9.fBDxyZ46-HoaBBMSlowmU0w5gxBZ6VFK1eLvIZcy69g", "user": {"createdAt": "2026-01-19T13:00:31.544Z", "email": "test1768827631256@example.com", "emailVerified": false, "firstName": "Test", "id": 1001, "lastName": "User", "phoneNumber": "+254712345678", "phoneVerified": false}}, "message": "User registered successfully. Please verify your email and phone.", "success": true}

      56 |             expect(res.statusCode).toBe(201);
      57 |             expect(res.body).toHaveProperty('success', true);
    > 58 |             expect(res.body).toHaveProperty('token');
         |                              ^
      59 |             expect(res.body.data).toHaveProperty('user');
      60 |         });
      61 |

      at Object.toHaveProperty (tests/auth.test.js:58:30)

  ΓùÅ Authentication API ΓÇ║ POST /api/auth/login ΓÇ║ should login with correct credentials

    expect(received).toHaveProperty(path)

    Expected path: "token"
    Received path: []

    Received value: {"data": {"token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MTAwMiwiaWF0IjoxNzY4ODI3NjMxLCJleHAiOjE3Njk0MzI0MzF9.wVfVrkYbymOX8g1z8TCge9L5ohGyG2nv_YMHM_EL9uo", "user": {"email": "logintest1768827631625@example.com", "firstName": "Login", "id": 1002, "lastName": "Test", "phoneNumber": "0712345678"}}, "message": "Login successful", "success": true}

      164 |             expect(res.statusCode).toBe(200);
      165 |             expect(res.body).toHaveProperty('success', true);
    > 166 |             expect(res.body).toHaveProperty('token');
          |                              ^
      167 |             
      168 |             bcrypt.compare.mockRestore();
      169 |         });

      at Object.toHaveProperty (tests/auth.test.js:166:30)

Test Suites: 1 failed, 1 total
Tests:       2 failed, 5 passed, 7 total
Snapshots:   0 total
Time:        4.738 s, estimated 6 s
Ran all test suites matching tests/auth.test.js.
Force exiting Jest: Have you considered using `--detectOpenHandles` to detect async operations that kept running after all tests finished?
