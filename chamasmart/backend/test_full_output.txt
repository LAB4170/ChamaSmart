
> chamasmart-backend@1.0.0 test
> jest --runInBand tests/auth.test.js --no-coverage

  console.log
    [dotenv@17.2.3] injecting env (3) from .env -- tip: ≡ƒöæ add access controls to secrets: https://dotenvx.com/ops

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  override existing env vars with { override: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    STABILIZED: Server running on port 5005

      at Server.log (server.js:235:11)

POST /api/auth/register 500 194.742 ms - anonymous - {"email":"test1768827012745@example.com","password":"[REDACTED]","firstName":"Test","lastName":"User","phoneNumber":"0712345678"}
POST /api/auth/register 400 3.684 ms - anonymous - {"email":"test@example.com"}
POST /api/auth/register 500 72.176 ms - anonymous - {"email":"duplicate1768827013089@example.com","password":"[REDACTED]","firstName":"Test","lastName":"User","phoneNumber":"0712345678"}
POST /api/auth/register 500 68.526 ms - anonymous - {"email":"duplicate1768827013089@example.com","password":"[REDACTED]","firstName":"Test","lastName":"User","phoneNumber":"0712345678"}
POST /api/auth/register 500 81.280 ms - anonymous - {"email":"logintest1768827013255@example.com","password":"[REDACTED]","firstName":"Login","lastName":"Test","phoneNumber":"0712345678"}
  console.log
    Querying database for user: nonexistent@example.com

      at log (controllers/authController.js:262:13)

POST /api/auth/login 500 159.545 ms - anonymous - {"email":"nonexistent@example.com","password":"[REDACTED]"}
FAIL tests/auth.test.js
  Authentication API
    POST /api/auth/register
      ├ù should register a new user (327 ms)
      ΓêÜ should reject registration with missing fields (23 ms)
      ├ù should reject duplicate email (165 ms)
    POST /api/auth/login
      ├ù should login with correct credentials (2 ms)
      ├ù should reject login with wrong password (5 ms)
      ├ù should reject login with non-existent email (172 ms)
  Health Check API
    ΓêÜ should return health status (20 ms)

  ΓùÅ Authentication API ΓÇ║ POST /api/auth/register ΓÇ║ should register a new user

    expect(received).toBe(expected) // Object.is equality

    Expected: 201
    Received: 500

      15 |                 });
      16 |
    > 17 |             expect(res.statusCode).toBe(201);
         |                                    ^
      18 |             expect(res.body).toHaveProperty('success', true);
      19 |             expect(res.body).toHaveProperty('token');
      20 |             expect(res.body.data).toHaveProperty('user_id');

      at Object.toBe (tests/auth.test.js:17:36)

  ΓùÅ Authentication API ΓÇ║ POST /api/auth/register ΓÇ║ should reject duplicate email

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 500

      58 |                 });
      59 |
    > 60 |             expect(res.statusCode).toBe(400);
         |                                    ^
      61 |             expect(res.body.message).toContain('already exists');
      62 |         });
      63 |     });

      at Object.toBe (tests/auth.test.js:60:36)

  ΓùÅ Authentication API ΓÇ║ POST /api/auth/login ΓÇ║ should login with correct credentials

    TypeError: Cannot read properties of undefined (reading 'email')

      85 |                 .post('/api/auth/login')
      86 |                 .send({
    > 87 |                     email: testUser.email,
         |                                     ^
      88 |                     password: 'Test123!@#',
      89 |                 });
      90 |

      at Object.email (tests/auth.test.js:87:37)

  ΓùÅ Authentication API ΓÇ║ POST /api/auth/login ΓÇ║ should reject login with wrong password

    TypeError: Cannot read properties of undefined (reading 'email')

       98 |                 .post('/api/auth/login')
       99 |                 .send({
    > 100 |                     email: testUser.email,
          |                                     ^
      101 |                     password: 'WrongPassword',
      102 |                 });
      103 |

      at Object.email (tests/auth.test.js:100:37)

  ΓùÅ Authentication API ΓÇ║ POST /api/auth/login ΓÇ║ should reject login with non-existent email

    expect(received).toBe(expected) // Object.is equality

    Expected: 401
    Received: 500

      114 |                 });
      115 |
    > 116 |             expect(res.statusCode).toBe(401);
          |                                    ^
      117 |         });
      118 |     });
      119 | });

      at Object.toBe (tests/auth.test.js:116:36)

Test Suites: 1 failed, 1 total
Tests:       5 failed, 2 passed, 7 total
Snapshots:   0 total
Time:        4.666 s, estimated 36 s
Ran all test suites matching tests/auth.test.js.
Force exiting Jest: Have you considered using `--detectOpenHandles` to detect async operations that kept running after all tests finished?
